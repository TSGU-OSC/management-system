import{p as O,f as S,e as w,s as F}from"./search-cb33e234.js";import{_ as M}from"./el-tree-2d203f22.js";import{u as $,aD as H,C,$ as V,d as L,h as z,K as I,b1 as x,aY as D,j as J,r as P,J as A,o as R,M as p,_ as U}from"./index-6e278e4c.js";import{i as W}from"./plus-791a9653.js";const Y=(e,{attrs:c},{tree:o,key:u})=>{const d=$("tree-select"),n={...O(H(e),Object.keys(S.props)),...c,valueKey:u,popperClass:C(()=>{const s=[d.e("popper")];return e.popperClass&&s.push(e.popperClass),s.join(" ")}),filterMethod:(s="")=>{e.filterMethod&&e.filterMethod(s),V(()=>{var h;(h=o.value)==null||h.filter(s)})},onVisibleChange:s=>{var h;(h=c.onVisibleChange)==null||h.call(c,s),e.filterable&&s&&n.filterMethod()}};return n},G=L({extends:w,setup(e,c){const o=w.setup(e,c);delete o.selectOptionClick;const u=z().proxy;return V(()=>{o.select.cachedOptions.get(u.value)||o.select.onOptionCreate(u)}),o},methods:{selectOptionClick(){this.$el.parentElement.click()}}});function T(e){return e||e===0}function j(e){return Array.isArray(e)&&e.length}function g(e){return Array.isArray(e)?e:T(e)?[e]:[]}function _(e,c,o,u,d){for(let n=0;n<e.length;n++){const s=e[n];if(c(s,n,e,d))return u?u(s,n,e,d):s;{const h=o(s);if(j(h)){const a=_(h,c,o,u,s);if(a)return a}}}}function q(e,c,o,u){for(let d=0;d<e.length;d++){const n=e[d];c(n,d,e,u);const s=o(n);j(s)&&q(s,c,o,n)}}const Q=(e,{attrs:c,slots:o,emit:u},{select:d,tree:n,key:s})=>{I(()=>e.modelValue,()=>{e.showCheckbox&&V(()=>{const t=n.value;t&&!W(t.getCheckedKeys(),g(e.modelValue))&&t.setCheckedKeys(g(e.modelValue))})},{immediate:!0,deep:!0});const h=C(()=>({value:s.value,label:"label",children:"children",disabled:"disabled",isLeaf:"isLeaf",...e.props})),a=(t,l)=>{var i;const r=h.value[t];return D(r)?r(l,(i=n.value)==null?void 0:i.getNode(a("value",l))):l[r]},N=g(e.modelValue).map(t=>_(e.data||[],l=>a("value",l)===t,l=>a("children",l),(l,i,r,y)=>y&&a("value",y))).filter(t=>T(t)),k=C(()=>{if(!e.renderAfterExpand&&!e.lazy)return[];const t=[];return q(e.data.concat(e.cacheData),l=>{const i=a("value",l);t.push({value:i,currentLabel:a("label",l),isDisabled:a("disabled",l)})},l=>a("children",l)),t}),m=C(()=>k.value.reduce((t,l)=>({...t,[l.value]:l}),{}));return{...O(H(e),Object.keys(M.props)),...c,nodeKey:s,expandOnClickNode:C(()=>!e.checkStrictly&&e.expandOnClickNode),defaultExpandedKeys:C(()=>e.defaultExpandedKeys?e.defaultExpandedKeys.concat(N):N),renderContent:(t,{node:l,data:i,store:r})=>t(G,{value:a("value",i),label:a("label",i),disabled:a("disabled",i)},e.renderContent?()=>e.renderContent(t,{node:l,data:i,store:r}):o.default?()=>o.default({node:l,data:i,store:r}):void 0),filterNodeMethod:(t,l,i)=>{var r;return e.filterNodeMethod?e.filterNodeMethod(t,l,i):t?(r=a("label",l))==null?void 0:r.includes(t):!0},onNodeClick:(t,l,i)=>{var r,y,K;if((r=c.onNodeClick)==null||r.call(c,t,l,i),!(e.showCheckbox&&e.checkOnClickNode))if(!e.showCheckbox&&(e.checkStrictly||l.isLeaf)){if(!a("disabled",t)){const f=(y=d.value)==null?void 0:y.options.get(a("value",t));(K=d.value)==null||K.handleOptionSelect(f)}}else e.expandOnClickNode&&i.proxy.handleExpandIconClick()},onCheck:(t,l)=>{if(!e.showCheckbox)return;const i=a("value",t),r=l.checkedKeys,y=e.multiple?g(e.modelValue).filter(f=>f in m.value&&!n.value.getNode(f)&&!r.includes(f)):[],K=r.concat(y);if(e.checkStrictly)u(x,e.multiple?K:K.includes(i)?i:void 0);else if(e.multiple)u(x,n.value.getCheckedKeys(!0));else{const f=_([t],v=>!j(a("children",v))&&!a("disabled",v),v=>a("children",v)),b=f?a("value",f):void 0,B=T(e.modelValue)&&!!_([t],v=>a("value",v)===e.modelValue,v=>a("children",v));u(x,b===e.modelValue||B?void 0:b)}V(()=>{var f;const b=g(e.modelValue);n.value.setCheckedKeys(b),(f=c.onCheck)==null||f.call(c,t,{checkedKeys:n.value.getCheckedKeys(),checkedNodes:n.value.getCheckedNodes(),halfCheckedKeys:n.value.getHalfCheckedKeys(),halfCheckedNodes:n.value.getHalfCheckedNodes()})})},cacheOptions:k}};var X=L({props:{data:{type:Array,default:()=>[]}},setup(e){const c=J(F);return I(()=>e.data,()=>{var o;e.data.forEach(d=>{c.cachedOptions.has(d.value)||c.cachedOptions.set(d.value,d)});const u=((o=c.selectWrapper)==null?void 0:o.querySelectorAll("input"))||[];Array.from(u).includes(document.activeElement)||c.setSelected()},{flush:"post",immediate:!0}),()=>{}}});const Z=L({name:"ElTreeSelect",inheritAttrs:!1,props:{...S.props,...M.props,cacheData:{type:Array,default:()=>[]}},setup(e,c){const{slots:o,expose:u}=c,d=P(),n=P(),s=C(()=>e.nodeKey||e.valueKey||"value"),h=Y(e,c,{select:d,tree:n,key:s}),{cacheOptions:a,...N}=Q(e,c,{select:d,tree:n,key:s}),k=A({});return u(k),R(()=>{Object.assign(k,{...O(n.value,["filter","updateKeyChildren","getCheckedNodes","setCheckedNodes","getCheckedKeys","setCheckedKeys","setChecked","getHalfCheckedNodes","getHalfCheckedKeys","getCurrentKey","getCurrentNode","setCurrentKey","setCurrentNode","getNode","remove","append","insertBefore","insertAfter"]),...O(d.value,["focus","blur"])})}),()=>p(S,A({...h,ref:m=>d.value=m}),{...o,default:()=>[p(X,{data:a.value}),p(M,A({...N,ref:m=>n.value=m}))]})}});var E=U(Z,[["__file","/home/runner/work/element-plus/element-plus/packages/components/tree-select/src/tree-select.vue"]]);E.install=e=>{e.component(E.name,E)};const ee=E,ae=ee;export{ae as E};
